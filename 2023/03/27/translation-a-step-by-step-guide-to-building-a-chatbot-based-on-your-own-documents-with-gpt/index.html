<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="没事儿,tong-h,Tong-H,tong-h blog"><meta name="descriptioon" content="personal blog by Tong-H"><meta name="renderer" content="wekit"><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/css/public.css"><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/iconfont.css"><title>(译)使用 GPT 基于个人文档建立聊天机器人的逐步教程 [ Tong-H ]</title><link rel="stylesheet" href="/css/partial/footer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><link rel="stylesheet" href="/css/partial/sidebar.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><meta name="generator" content="Hexo 5.4.0"></head><body><link rel="stylesheet" href="/css/partial/header.css"><div class="header"><div class="maxwidth"><div class="nav"><a id="artlist" href="/404"><i class="iconfont icon404"></i><span class="headhid">&nbsp;404</span></a><a id="artlist" href="/archives"><i class="iconfont iconarchives"></i><span class="headhid">&nbsp;Archives</span></a><a id="artlist" href="/link"><i class="iconfont iconlink"></i><span class="headhid">&nbsp;Link</span></a><a id="artlist" href="/about"><i class="iconfont iconabout"></i><span class="headhid">&nbsp;About</span></a></div><a class="search" href="/">TONG-H</a></div></div><div class="main"> <div class="maxwidth"><link rel="stylesheet" href="/css/partial/sidebar.css"><div id="sidebar"><div class="social"><a href="/archives" title="Home"><i class="iconfont iconHome"></i></a><a href="mailto:tongt0232@gmail.com" title="E-Mail"><i class="iconfont iconweibiaoti554"></i></a><a target="_blank" rel="noopener" href="https://github.com/tong-h" title="GitHub"><i class="iconfont iconGitHub"></i></a><a target="_blank" rel="noopener" href="https://juejin.cn/user/1204720474809741" title="juejin"><img src="/images/juejinicon-sidebar.png"></a><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/20de04cc53de" title="jianshu"><img src="/images/jianicon-sidebar.png"></a></div><div class="structure category-list"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A2%E7%B4%A2%E4%B8%8D%E5%90%8C%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">探索不同的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%90%E6%AD%A5%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3%E9%97%AE%E7%AD%94%E8%81%8A%E5%A4%A9%E6%9C%BA%E5%99%A8%E4%BA%BA"><span class="toc-number">2.</span> <span class="toc-text">逐步创建文档问答聊天机器人</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">前提条件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">工作流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-number">5.</span> <span class="toc-text">结语</span></a></li></ol></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/NOTES/">NOTES</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OTHER/">OTHER</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WEB/">WEB</a><span class="category-list-count">45</span></li></ul><div class="tags"><a href="/tags/CI-CD/" style="font-size: 12px; color: #ffac00">CI/CD</a> <a href="/tags/Cache/" style="font-size: 15px; color: #ec9d00">Cache</a> <a href="/tags/ECharts/" style="font-size: 12px; color: #ffac00">ECharts</a> <a href="/tags/Electron/" style="font-size: 12px; color: #ffac00">Electron</a> <a href="/tags/Git/" style="font-size: 12px; color: #ffac00">Git</a> <a href="/tags/JS-%E6%8B%BE%E9%81%97/" style="font-size: 12px; color: #ffac00">JS 拾遗</a> <a href="/tags/JSON/" style="font-size: 12px; color: #ffac00">JSON</a> <a href="/tags/Linux/" style="font-size: 12px; color: #ffac00">Linux</a> <a href="/tags/OTHER/" style="font-size: 12px; color: #ffac00">OTHER</a> <a href="/tags/Svg/" style="font-size: 12px; color: #ffac00">Svg</a> <a href="/tags/angular/" style="font-size: 15px; color: #ec9d00">angular</a> <a href="/tags/canvas/" style="font-size: 21px; color: #c77e00">canvas</a> <a href="/tags/cordova/" style="font-size: 21px; color: #c77e00">cordova</a> <a href="/tags/domain/" style="font-size: 12px; color: #ffac00">domain</a> <a href="/tags/ffmpeg/" style="font-size: 12px; color: #ffac00">ffmpeg</a> <a href="/tags/gitment/" style="font-size: 12px; color: #ffac00">gitment</a> <a href="/tags/hexo/" style="font-size: 18px; color: #da8d00">hexo</a> <a href="/tags/http/" style="font-size: 12px; color: #ffac00">http</a> <a href="/tags/markdown/" style="font-size: 12px; color: #ffac00">markdown</a> <a href="/tags/micro-frontend/" style="font-size: 15px; color: #ec9d00">micro_frontend</a> <a href="/tags/mpvue/" style="font-size: 12px; color: #ffac00">mpvue</a> <a href="/tags/mysql/" style="font-size: 12px; color: #ffac00">mysql</a> <a href="/tags/nginx/" style="font-size: 12px; color: #ffac00">nginx</a> <a href="/tags/nodejs/" style="font-size: 12px; color: #ffac00">nodejs</a> <a href="/tags/npm/" style="font-size: 12px; color: #ffac00">npm</a> <a href="/tags/python/" style="font-size: 18px; color: #da8d00">python</a> <a href="/tags/server/" style="font-size: 12px; color: #ffac00">server</a> <a href="/tags/translation/" style="font-size: 24px; color: #b46e00">translation</a> <a href="/tags/typescript/" style="font-size: 12px; color: #ffac00">typescript</a> <a href="/tags/vue/" style="font-size: 12px; color: #ffac00">vue</a> <a href="/tags/yarn/" style="font-size: 12px; color: #ffac00">yarn</a> <a href="/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE/" style="font-size: 12px; color: #ffac00">原型链</a> <a href="/tags/%E5%9B%BD%E9%99%85%E5%8C%96/" style="font-size: 12px; color: #ffac00">国际化</a> <a href="/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%9A%E5%8A%A8%E6%9D%A1/" style="font-size: 12px; color: #ffac00">自定义滚动条</a> <a href="/tags/%E8%B7%A8%E5%9F%9F/" style="font-size: 12px; color: #ffac00">跨域</a></div></div><div class="post rightside"><h1 class="artititle">(译)使用 GPT 基于个人文档建立聊天机器人的逐步教程</h1><div class="info"><i class="iconfont iconwenzi" title="字数">2.2k</i><i class="iconfont iconshijian" title="阅读时长">7</i><i class="iconfont iconarchives" title="文章分类"><span>WEB</span></i><i class="iconfont iconbiaoqian" title="文章标签"><span>translation</span></i><i class="iconfont iconshijian"><span title="文章发布时间">2023-03-27</span></i><i class="iconfont iconshijian"><span title="文章更新时间">2025-02-10</span></i></div><div class="postDetail"><blockquote>
<ul>
<li>原文地址：<a target="_blank" rel="noopener" href="https://bootcamp.uxdesign.cc/a-step-by-step-guide-to-building-a-chatbot-based-on-your-own-documents-with-gpt-2d550534eea5">A step-by-step guide to building a chatbot based on your own documents with GPT</a></li>
<li>原文作者：<a target="_blank" rel="noopener" href="https://medium.com/@guodong_zhao">Guodong (Troy) Zhao</a></li>
<li>译文出自：<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner">掘金翻译计划</a></li>
<li>本文永久链接：<a target="_blank" rel="noopener" href="https://github.com/itcodes/gold-miner/blob/master/article/2023/A-step-by-step-guide-to-building-a-chatbot-based-on-your-own-documents-with-GPT.md">https://github.com/itcodes/gold-miner/blob/master/article/2023/A-step-by-step-guide-to-building-a-chatbot-based-on-your-own-documents-with-GPT.md</a></li>
<li>译者：<a target="_blank" rel="noopener" href="https://github.com/Tong-H">tong-h</a></li>
<li>校对者：</li>
</ul>
</blockquote>
<p>与 ChatGPT 聊天是有趣且丰富的，过去一段时间我一直在与它闲聊并探索新的想法。但这些都是比较随机的用例，新奇感很快就减弱，尤其是当你意识到它可以产生幻觉的时候。</p>
<p>我们如何以更高效的方式使用它？随着 OpenAI 最近发布的 GPT 3.5 系列 API，我们能做的事远不止是闲聊。对于企业和个人使用来说更高效的用例是 QA （问答），<strong>你用自然语言向机器人询问关于你自己的文档/数据，通过从文档中检索信息并生成回应，它可以快速的回答你</strong> [1]。你可以用它来做客户支持，综合用户研究，你的个人知识管理等等</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*gUE4sFAEIhoR07IMUhzLaA.jpeg"></p>
<p>向机器人询问与文档有关的问题。用稳定扩散法生成的图像。</p>
<p>在本文中，我将探讨如何基于自己的数据创建自己的问答机器人，包括为什么有些方法不生效，以及使用 llama-index 和 GPT API 高效的创建文档问答聊天机器人的逐步引导</p>
<p>(如果你只想知道如何建立问答聊天机器人，你可以直接跳到“逐步创建文档问答聊天机器人”部分)</p>
<h2 id="探索不同的方法"><a href="#探索不同的方法" class="headerlink" title="探索不同的方法"></a>探索不同的方法</h2><p>我的日常工作是产品管理，阅读用户反馈以及内部文档占据了我生活的很大一部分。当 ChatGPT 出现的时候，我马上就想到了使用它作为助手来帮助我合成用户反馈，或者找到和我现在正在做的功能相关的旧产品文档。</p>
<p>我首先想到的是使用我自己的数据对 GPT 模型微调（fine-tuning）来实现目标。但微调的花费不少，而且需要一个有案例的大型数据库。每次当文档发生改变时都去微调也同样不可能。更关键的是微调根本不能让模型知道文档中的所有信息，而是教给模型新技能。因此，对多文档问答来说，微调并不是一个可行的方式。</p>
<p>我想到的第二个方法是通过在提示中提供上下文来提示工程。比如，我可以在真实问题之前附加原始文档内容，而不是直接提问。但是 GPT 模型的注意广度是受限的，它只能接受提示中的几千字（大约 4000 个符号或者 3000 字）。我们有成千封用户反馈邮件和数百份产品文档，所以把所有内容放在提示中是不可能的。往 API 传递长字符串的成本也是比较高的， 因为定价是基于使用的符号数量。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我将根据下面的内容向你询问：—上下文的开始—你的文档内容—上下文的结束—我的问题是：“用户希望在 <span class="keyword">app</span> 中看到什么特性？”</span><br></pre></td></tr></table></figure>

<p>（如果你想要学习更多关于 GPT 的微调和提示工程，你可以阅读这篇文章：<a target="_blank" rel="noopener" href="https://medium.com/design-bootcamp/3-ways-to-tailor-foundation-language-models-like-gpt-for-your-business-e68530a763bd">为个人业务量身定制的基础语言模型（如GPT）的3种方法</a>）</p>
<p>由于提示受限于输入符号数量，所以我有一个想法，首先使用算法搜索文档，并选择相关的摘要，然后只将这些相关的内容以及我的问题传递给 GPT。当我研究这个想法的时候，我偶然发现一个叫 gpt-index 的库（现在更名为 LlamaIndex），这个库完全符合我的想法，而且使用简单 [2]。</p>
<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*Zi85PvOv8tpaB4SvpTRlHw.png"></p>
<p>从文件中提取相关部分，然后将其反馈给提示。图标来自<a target="_blank" rel="noopener" href="https://www.flaticon.com/">https://www.flaticon.com/</a></p>
<p>在下一节中，我将给一个分步教程关于如何使用 LlamaIndex 和 GPT 来创建一个基于个人数据的问答聊天机器人。</p>
<h2 id="逐步创建文档问答聊天机器人"><a href="#逐步创建文档问答聊天机器人" class="headerlink" title="逐步创建文档问答聊天机器人"></a>逐步创建文档问答聊天机器人</h2><p>在本节中，我们将基于现有的文档用 LlamaIndex 和 GPT (text-davinci-003) 创建一个问答聊天机器人，这样你可以就你的文档提出问题，并从聊天机器人获得答案，全部都是使用自然语言。</p>
<h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p>在开始之前，我们需要准备以下几件事：</p>
<ul>
<li>你的 OpenAI API Key，可以在 <a target="_blank" rel="noopener" href="https://platform.openai.com/account/api-keys">https://platform.openai.com/account/api-keys</a> 中找到。</li>
<li>你的文档的数据库，LlamaIndex 支持多种不同的数据来源，比如 Notion，Google Docs，Asana 等等 [3]。在本教程中，我们只使用一个简单的 text 文件来做示范。</li>
<li> 一个本地 Python 环境或者在线 <a target="_blank" rel="noopener" href="https://colab.research.google.com/">Google Colab notebook</a>。</li>
</ul>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><p>这个工作流程简单易懂，只需要几个步骤：</p>
<ol>
<li>使用 LlamaIndex 创建文档数据的索引。</li>
<li>使用自然语言查询索引。</li>
<li>LlamaIndex 将检索相关部分并传递给 GPT 提示。</li>
<li>结合相关上下文询问 GPT，并构建反应。</li>
</ol>
<p>LlamaIndex 所做的是将原始的文档数据转化为矢量索引，这会使查询变得非常高效。LlamaIndex 将基于查询和数据的相似性来使用这个索引去找到最相关的部分。再将检索到的信息插入到提示中发送给 GPT，这样 GPT 就有了回答问题的上下文。</p>
<p><strong>设置</strong></p>
<p>我们需要先安装 LlamaIndex，只需要在终端或者 Google Colab notebook 中运行以下命令。这些命令会安装 LlamaIndex 和 OpenAI。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!pip <span class="keyword">install </span><span class="keyword">llama-index!pip </span><span class="keyword">install </span>openai</span><br></pre></td></tr></table></figure>

<p>下一步，我们将在 python 中导入这些库，然后在一个新的 .py 文件中设置你的 OpenAI API key。</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> llama_index <span class="keyword">import</span> GPTSimpleVectorIndex, Document, SimpleDirectoryReaderimport osos.environ[<span class="string">&#x27;OPENAI_API_KEY&#x27;</span>] = <span class="string">&#x27;sk-YOUR-API-KEY&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>构建索引并保存</strong></p>
<p>在安装以及导入了所需的库之后，我们需要去构建文档的索引。</p>
<p>我们可以使用 LllamaIndex 提供的 SimpleDirectoryReader 方法来加载文档，或者也可以从字符串中加载。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">documents = SimpleDirectoryReader(<span class="string">&#x27;your_directory&#x27;</span>)<span class="selector-class">.load_data</span>()text_list = <span class="selector-attr">[text1, text2, ...]</span>documents = <span class="selector-attr">[Document(t) for t in text_list]</span></span><br></pre></td></tr></table></figure>

<p>LlamaIndex 也提供多种不同的数据连接器，包括 Notion，Asana，Google Drive，Obsidian 等等。你可以在 <a target="_blank" rel="noopener" href="https://llamahub.ai/">https://llamahub.ai/</a> 中找到可用的数据连接器。</p>
<p>在文档加载后，我们可以用以下方法简单的构建索引</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index</span> = GPTSimpleVectorIndex(documents)</span><br></pre></td></tr></table></figure>

<p>如果你想要保存索引并加载它以便后续使用，你可以使用以下方法</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.save<span class="constructor">_to_disk(&#x27;<span class="params">index</span>.<span class="params">json</span>&#x27;)</span>index = <span class="module-access"><span class="module"><span class="identifier">GPTSimpleVectorIndex</span>.</span></span>load<span class="constructor">_from_disk(&#x27;<span class="params">index</span>.<span class="params">json</span>&#x27;)</span></span><br></pre></td></tr></table></figure>

<p><strong>查询索引并获取响应</strong></p>
<p>查询索引是很简单的</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">response</span> = index.query(<span class="string">&quot;What features do users want to see in the app?&quot;</span>)pr<span class="built_in">int</span>(<span class="built_in">response</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://miro.medium.com/v2/resize:fit:1400/1*g0YR2LwF1oa1mfP4U0ZBcQ.png"></p>
<p>一个响应案例</p>
<p>然后就可以了！你会得到打印的答案。在后台，LlamaIndex 会接受你的提示并在索引中搜索相关的语块，然后将你的提示以及相关的语块传递给 GPT。</p>
<p><strong>一些关于高级使用的说明</strong></p>
<p>上面的步骤仅仅展示了 LlamaIndex 和 GPT 非常简单的回答问题的入门用法。但你可以做更多。事实上，你可以配置 LlamaIndex 去使用不同的大型语言模型（LLM），使用不同类型的索引去做不同的任务，用一个新的索引来更新现有的索引等等。如果你感兴趣，可以阅读他们的文档 <a target="_blank" rel="noopener" href="https://gpt-index.readthedocs.io/en/latest/index.html">https://gpt-index.readthedocs.io/en/latest/index.html</a>。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>在这篇文章中，我们看到了如何将 GPT 与 LlamaIndex 结合起来，建立一个文档问答聊天机器人。虽然 GPT（和其他 LLM）本身就很强大，但如果我们把它与其他工具、数据或进程结合起来，它的力量就可以大大放大。</p>
<p>你会用一个文档问答聊天机器人做什么？</p>
<blockquote>
<p>如果发现译文存在错误或其他需要改进的地方，欢迎到 <a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner">掘金翻译计划</a> 对译文进行修改并 PR，也可获得相应奖励积分。文章开头的 <strong>本文永久链接</strong> 即为本文在 GitHub 上的 MarkDown 链接。</p>
</blockquote>
<hr>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner">掘金翻译计划</a> 是一个翻译优质互联网技术文章的社区，文章来源为 <a target="_blank" rel="noopener" href="https://juejin.im/">掘金</a> 上的英文分享文章。内容覆盖 <a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#android">Android</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#ios">iOS</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E5%89%8D%E7%AB%AF">前端</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E5%90%8E%E7%AB%AF">后端</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E5%8C%BA%E5%9D%97%E9%93%BE">区块链</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E4%BA%A7%E5%93%81">产品</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E8%AE%BE%E8%AE%A1">设计</a>、<a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner#%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD">人工智能</a>等领域，想要查看更多优质译文请持续关注 <a target="_blank" rel="noopener" href="https://github.com/xitu/gold-miner">掘金翻译计划</a>、<a target="_blank" rel="noopener" href="http://weibo.com/juejinfanyi">官方微博</a>、<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/juejinfanyi">知乎专栏</a>。</p>
</blockquote>
</div><link rel="stylesheet" href="/css/partial/footer.css"><div class="footer"><p><span>Copyright © 2017 - 2023</span><a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/">蜀ICP备19024124号</a></p><p><i class="iconfont iconchakan"><span>本站总访问量</span><span id="busuanzi_container_site_pv">  <span id="busuanzi_value_site_pv"></span> </span></i><i class="iconfont iconabout"><span>本站访客数</span><span id="busuanzi_container_site_uv">  <span id="busuanzi_value_site_uv"></span> </span></i></p></div></div><script> <console class="log" page theme></console></script></div></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>