<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="keywords" content="没事儿,tong-h,Tong-H,tong-h blog"><meta name="descriptioon" content="personal blog by Tong-H"><meta name="renderer" content="wekit"><link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/css/public.css"><link rel="stylesheet" href="/css/reset.css"><link rel="stylesheet" href="/css/iconfont.css"><title>Nginx的反向代理跨域 [ Tong-H ]</title><link rel="stylesheet" href="/css/partial/footer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><link rel="stylesheet" href="/css/partial/sidebar.css"><link rel="stylesheet" href="/css/post.css"><link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css"><meta name="generator" content="Hexo 5.4.0"></head><body><link rel="stylesheet" href="/css/partial/header.css"><div class="header"><div class="maxwidth"><div class="nav"><a id="artlist" href="/404"><i class="iconfont icon404"></i><span class="headhid">&nbsp;404</span></a><a id="artlist" href="/archives"><i class="iconfont iconarchives"></i><span class="headhid">&nbsp;Archives</span></a><a id="artlist" href="/about"><i class="iconfont iconabout"></i><span class="headhid">&nbsp;About</span></a></div><a class="search" href="/">TONG-H</a></div></div><div class="main"> <div class="maxwidth"><link rel="stylesheet" href="/css/partial/sidebar.css"><div id="sidebar"><div class="social"><a href="/archives" title="Home"><i class="iconfont iconHome"></i></a><a href="mailto:tongt0232@gmail.com" title="E-Mail"><i class="iconfont iconweibiaoti554"></i></a><a target="_blank" rel="noopener" href="https://github.com/tong-h" title="GitHub"><i class="iconfont iconGitHub"></i></a><a target="_blank" rel="noopener" href="https://juejin.cn/user/1204720474809741" title="juejin"><img src="/images/juejinicon-sidebar.png"></a><a target="_blank" rel="noopener" href="https://www.jianshu.com/u/20de04cc53de" title="jianshu"><img src="/images/jianicon-sidebar.png"></a></div><div class="structure category-list"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%A8%E5%9F%9F%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">什么是跨域？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">产生的原因？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%E9%99%90%E5%88%B6%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%A7%8D%E8%A1%8C%E4%B8%BA%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">同源策略限制以下几种行为：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E8%B7%A8%E5%9F%9F%E5%9C%BA%E6%99%AF"><span class="toc-number">2.2.</span> <span class="toc-text">常见跨域场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">3.</span> <span class="toc-text">跨域解决方案</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F"><span class="toc-number">4.</span> <span class="toc-text">nginx反向代理解决跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#proxy-pass%E6%8A%8A%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86%E5%88%B0%E5%85%B6%E4%BB%96%E4%B8%BB%E6%9C%BA"><span class="toc-number">4.1.</span> <span class="toc-text">proxy_pass把请求代理到其他主机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#carrots-admin-ajax"><span class="toc-number">4.2.</span> <span class="toc-text">&#x2F;carrots-admin-ajax&#x2F;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx-rewrite%E6%8C%87%E4%BB%A4%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F%EF%BC%9A"><span class="toc-number">4.3.</span> <span class="toc-text">nginx rewrite指令执行顺序：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0"><span class="toc-number">5.</span> <span class="toc-text">参考文章</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="toc-number">6.</span> <span class="toc-text">其他问题</span></a></li></ol></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Daily-Snippets/">Daily Snippets</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/">Frontend</a><span class="category-list-count">48</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">Notes</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Others/">Others</a><span class="category-list-count">14</span></li></ul><div class="tags"><a href="/tags/CI-CD/" style="font-size: 12px; color: #ffac00">CI/CD</a> <a href="/tags/Cache/" style="font-size: 15px; color: #ec9d00">Cache</a> <a href="/tags/ECharts/" style="font-size: 12px; color: #ffac00">ECharts</a> <a href="/tags/Electron/" style="font-size: 12px; color: #ffac00">Electron</a> <a href="/tags/Git/" style="font-size: 12px; color: #ffac00">Git</a> <a href="/tags/JS/" style="font-size: 12px; color: #ffac00">JS</a> <a href="/tags/JSON/" style="font-size: 12px; color: #ffac00">JSON</a> <a href="/tags/Linux/" style="font-size: 12px; color: #ffac00">Linux</a> <a href="/tags/OTHERS/" style="font-size: 12px; color: #ffac00">OTHERS</a> <a href="/tags/Svg/" style="font-size: 12px; color: #ffac00">Svg</a> <a href="/tags/angular/" style="font-size: 15px; color: #ec9d00">angular</a> <a href="/tags/canvas/" style="font-size: 21px; color: #c77e00">canvas</a> <a href="/tags/cordova/" style="font-size: 21px; color: #c77e00">cordova</a> <a href="/tags/domain/" style="font-size: 12px; color: #ffac00">domain</a> <a href="/tags/ffmpeg/" style="font-size: 12px; color: #ffac00">ffmpeg</a> <a href="/tags/financial/" style="font-size: 12px; color: #ffac00">financial</a> <a href="/tags/gitment/" style="font-size: 12px; color: #ffac00">gitment</a> <a href="/tags/hexo/" style="font-size: 18px; color: #da8d00">hexo</a> <a href="/tags/http/" style="font-size: 12px; color: #ffac00">http</a> <a href="/tags/japanese/" style="font-size: 15px; color: #ec9d00">japanese</a> <a href="/tags/js/" style="font-size: 12px; color: #ffac00">js</a> <a href="/tags/markdown/" style="font-size: 12px; color: #ffac00">markdown</a> <a href="/tags/micro-frontend/" style="font-size: 15px; color: #ec9d00">micro_frontend</a> <a href="/tags/mpvue/" style="font-size: 12px; color: #ffac00">mpvue</a> <a href="/tags/mysql/" style="font-size: 12px; color: #ffac00">mysql</a> <a href="/tags/nginx/" style="font-size: 12px; color: #ffac00">nginx</a> <a href="/tags/nodejs/" style="font-size: 12px; color: #ffac00">nodejs</a> <a href="/tags/npm/" style="font-size: 12px; color: #ffac00">npm</a> <a href="/tags/python/" style="font-size: 18px; color: #da8d00">python</a> <a href="/tags/server/" style="font-size: 12px; color: #ffac00">server</a> <a href="/tags/shell/" style="font-size: 12px; color: #ffac00">shell</a> <a href="/tags/threeJs/" style="font-size: 12px; color: #ffac00">threeJs</a> <a href="/tags/translation/" style="font-size: 24px; color: #b46e00">translation</a> <a href="/tags/typescript/" style="font-size: 12px; color: #ffac00">typescript</a> <a href="/tags/vue/" style="font-size: 12px; color: #ffac00">vue</a> <a href="/tags/worker/" style="font-size: 12px; color: #ffac00">worker</a> <a href="/tags/yarn/" style="font-size: 12px; color: #ffac00">yarn</a> <a href="/tags/%E5%8E%9F%E5%9E%8B%E9%93%BE/" style="font-size: 12px; color: #ffac00">原型链</a> <a href="/tags/%E5%9B%BD%E9%99%85%E5%8C%96/" style="font-size: 12px; color: #ffac00">国际化</a> <a href="/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%BB%9A%E5%8A%A8%E6%9D%A1/" style="font-size: 12px; color: #ffac00">自定义滚动条</a> <a href="/tags/%E8%B7%A8%E5%9F%9F/" style="font-size: 12px; color: #ffac00">跨域</a></div></div><div class="post rightside"><h1 class="artititle">Nginx的反向代理跨域</h1><div class="info"><i class="iconfont iconwenzi" title="字数">1.6k</i><i class="iconfont iconshijian" title="阅读时长">6</i><i class="iconfont iconarchives" title="文章分类"><span>Others</span></i><i class="iconfont iconbiaoqian" title="文章标签"><span>nginx</span></i><i class="iconfont iconshijian"><span title="文章发布时间">2017-12-01</span></i><i class="iconfont iconshijian"><span title="文章更新时间">2025-04-26</span></i></div><div class="postDetail"><h1 id="什么是跨域？"><a href="#什么是跨域？" class="headerlink" title="什么是跨域？"></a>什么是跨域？</h1><p>跨域是指a页面想获取b页面资源，如果a、b页面的协议、域名、端口、子域名不同，或是a页面为ip地址， b页面为域名地址，所进行的访问行动都是跨域</p>
<h1 id="产生的原因？"><a href="#产生的原因？" class="headerlink" title="产生的原因？"></a>产生的原因？</h1><p>浏览器为了安全问题一般都限制了跨域访问，也就是不允许跨域请求资源</p>
<p>同ip（或domain）,同端口，同协议视为同一个域，一个域内的脚本仅仅具有本域内的权限，可以理解为本域脚本只能读写 本域内的资源，而无法访问其它域的资源。这种安全限制称为同源策略</p>
<p>现代浏览器在安全性和可用性之间选择了一个平衡点。 在遵循同源策略的基础上，选择性地为同源策略“开放了后门”。例如img script style等标签，都允许垮域引用资源,然而， 你也只能是引用这些资源而已，并不能读取这些资源的内容</p>
<h2 id="同源策略限制以下几种行为："><a href="#同源策略限制以下几种行为：" class="headerlink" title="同源策略限制以下几种行为："></a>同源策略限制以下几种行为：</h2><p>1.Cookie、LocalStorage 和 IndexDB 无法读取</p>
<p>2.DOM 和 Js对象无法获得</p>
<p>3.AJAX 请求不能发送</p>
<h2 id="常见跨域场景"><a href="#常见跨域场景" class="headerlink" title="常见跨域场景"></a>常见跨域场景</h2><p><a target="_blank" rel="noopener" href="http://www.domain.com/a.jshttp://www.domain.com/b.js">http://www.domain.com/a.jshttp://www.domain.com/b.js</a> 同一域名，不同文件或路径 允许<a target="_blank" rel="noopener" href="http://www.domain.com/lab/c.jshttp://www.domain.com:8000/a.jshttp://www.domain.com/b.js">http://www.domain.com/lab/c.jshttp://www.domain.com:8000/a.jshttp://www.domain.com/b.js</a> 同一域名，不同端口 不允许<a target="_blank" rel="noopener" href="http://www.domain.com/a.jshttps://www.domain.com/b.js">http://www.domain.com/a.jshttps://www.domain.com/b.js</a> 同一域名，不同协议 不允许<a target="_blank" rel="noopener" href="http://www.domain.com/a.jshttp://192.168.4.12/b.js">http://www.domain.com/a.jshttp://192.168.4.12/b.js</a> 域名和域名对应相同ip 不允许<a target="_blank" rel="noopener" href="http://www.domain.com/a.jshttp://x.domain.com/b.js">http://www.domain.com/a.jshttp://x.domain.com/b.js</a> 主域相同，子域不同 不允许<a target="_blank" rel="noopener" href="http://domain.com/c.jshttp://www.domain1.com/a.jshttp://www.domain2.com/b.js">http://domain.com/c.jshttp://www.domain1.com/a.jshttp://www.domain2.com/b.js</a> 不同域名 不允许</p>
<h1 id="跨域解决方案"><a href="#跨域解决方案" class="headerlink" title="跨域解决方案"></a>跨域解决方案</h1><p>1、 通过jsonp跨域</p>
<p>2、 document.domain + iframe跨域</p>
<p>3、 location.hash + iframe</p>
<p>4、 window.name + iframe跨域</p>
<p>5、 postMessage跨域</p>
<p>6、 跨域资源共享（CORS）</p>
<p>7、 nginx代理跨域</p>
<p>8、 nodejs中间件代理跨域</p>
<p>9、 WebSocket协议跨域</p>
<h1 id="nginx反向代理解决跨域"><a href="#nginx反向代理解决跨域" class="headerlink" title="nginx反向代理解决跨域"></a>nginx反向代理解决跨域</h1><p>正向代理：代理位于网站和客户端中间， 客户端无法访问某网站，就将请求发送给代理服务器，代理从网站取回来再发送给客户端，网站并不知道为谁提供服务</p>
<p>反向代理：客户端访问某网站的一个页面， 但是网站并没有，就偷偷从另外一台服务器上取回来,然后作为自己的内容吐给用户，用户不知道真正提供服务的是谁</p>
<p>对于浏览器来说，访问的就是同源服务器上的一个url。而nginx通过 检测url前缀，把http请求转发到后面真实的物理服务器。并通过rewrite命令把前缀再去掉。这样真实的服务器就可以正确 处理请求，并且并不知道这个请求是来自代理服务器的。</p>
<p>简单说，nginx服务器欺骗了浏览器，让它认为这是同源调用，从而解决了浏览器的跨域问题。又通过重写url，欺骗了真实 的服务器，让它以为这个http请求是直接来自与用户浏览器的。</p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Location/carrots-admin-ajax/&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">proxy_pass http</span>://dev<span class="variable">.admin</span><span class="variable">.carrots</span><span class="variable">.ptteng</span><span class="variable">.com</span>/;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="proxy-pass把请求代理到其他主机"><a href="#proxy-pass把请求代理到其他主机" class="headerlink" title="proxy_pass把请求代理到其他主机"></a>proxy_pass把请求代理到其他主机</h2><p>两种写法h<a target="_blank" rel="noopener" href="http://dev.admin.carrots.ptteng.com/">http://dev.admin.carrots.ptteng.com/</a>  和  <a target="_blank" rel="noopener" href="http://dev.admin.carrots.ptteng.com/">http://dev.admin.carrots.ptteng.com</a></p>
<p>如果访问url=<a target="_blank" rel="noopener" href="http://server/html/test.jsp%EF%BC%8C%E5%88%99%E8%A2%ABnginx%E4%BB%A3%E7%90%86%E5%90%8E">http://server/html/test.jsp，则被nginx代理后</a></p>
<p>  情况1: 将test/作为根路径，请求test/路径下的资源。</p>
<p>  情况2: 则被nginx代理后，请求路径会变为<a target="_blank" rel="noopener" href="http://proxy_pass/test.jsp%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AEserver%E7%9A%84%E6%A0%B9%E8%B5%84%E6%BA%90%E3%80%82">http://proxy_pass/test.jsp，直接访问server的根资源。</a></p>
<h2 id="carrots-admin-ajax"><a href="#carrots-admin-ajax" class="headerlink" title="/carrots-admin-ajax/"></a>/carrots-admin-ajax/</h2><p>是一个匹配规则，用于拦截请求，匹配任何以/proxy/html/开头的地址，匹配符合以后，停止往下搜索正则。</p>
<p>对于浏览器来说，访问的就是同源服务器上的一个url。而nginx通过检测url前缀，把http请求转发到后面真实的物理服务器。并通过rewrite命令把前缀再去掉。这样真实的服务器就可以正确处理请求，并且并不知道这个请求是来自代理服务器的。</p>
<p>简单说，nginx服务器欺骗了浏览器，让它认为这是同源调用，从而解决了浏览器的跨域问题。又通过重写url，欺骗了真实的服务器，让它以为这个http请求是直接来自与用户浏览器的。</p>
<h2 id="nginx-rewrite指令执行顺序："><a href="#nginx-rewrite指令执行顺序：" class="headerlink" title="nginx rewrite指令执行顺序："></a>nginx rewrite指令执行顺序：</h2><p>1.执行server块的rewrite指令(这里的块指的是server关键字后{}包围的区域，其它xx块类似)</p>
<p>2.执行location匹配</p>
<p>3.执行选定的location中的rewrite指令</p>
<p>如果其中某步URI被重写，则重新循环执行1-3，直到找到真实存在的文件</p>
<p>如果循环超过10次，则返回500 Internal Server Error错误</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p>参考一：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/gabrielchen/p/5066120.html">https://www.cnblogs.com/gabrielchen/p/5066120.html</a></p>
<p>参考二：<a target="_blank" rel="noopener" href="http://blog.csdn.net/shendl/article/details/48443299">http://blog.csdn.net/shendl/article/details/48443299</a></p>
<h1 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h1><p>Q：例如img script style等标签，都允许垮域引用资源？</p>
<p>A：在浏览器中，并且加载的方式其实相当于一次普通的GET请求，唯一不同的是，为了安全起见，浏览器不允许这种方式下对加载到的资源的读写操作，而只能使用标签本身应当具备的能力（比如脚本执行、样式应用等等）。</p>
<p>Q：JSONP和nginx跨域有什么不同</p>
<p>JSONP和nginx是完全不同的 是可以跨域的，而且在跨域脚本中可以直接回调当前脚本的函数</p>
<p>原理：是可以跨域的，而且在跨域脚本中可以直接回调当前脚本的函数</p>
<p>script标签是可以加载异域的JavaScript并执行的，通过预先设定好的callback函数来实现和母页面的交互。它有一个大名，叫做JSONP跨域，JSONP是JSON with Padding的略称。它是一个非官方的协议，明明是加载script，为啥和JSON扯上关系呢？原来就是这个callback函数，对它的使用有一个典型的方式，就是通过JSON来传参，即将JSON数据填充进回调函数，这就是JSONP的JSON+Padding的含义。JSONP只支持GET请求。</p>
<p>欢迎留言交流  (´▽`ʃ♡ƪ)</p>
</div><link rel="stylesheet" href="/css/partial/footer.css"><div class="footer"><p><span>Copyright © 2017 - 2023</span><a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/">蜀ICP备19024124号</a></p><p><i class="iconfont iconchakan"><span>本站总访问量</span><span id="busuanzi_container_site_pv">  <span id="busuanzi_value_site_pv"></span> </span></i><i class="iconfont iconabout"><span>本站访客数</span><span id="busuanzi_container_site_uv">  <span id="busuanzi_value_site_uv"></span> </span></i></p></div></div><script> <console class="log" page theme></console></script></div></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>